<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:FamilyFinance.ViewModels"
             xmlns:models="clr-namespace:FamilyFinance.Models"
             x:Class="FamilyFinance.Views.AccountTypePage"
             Title="Account Types">

    <Grid RowDefinitions="*,Auto">

        <!-- Main Content -->
        <Grid Grid.Row="0" RowDefinitions="*,Auto">

            <!-- Account Types List -->
            <CollectionView Grid.Row="0"
                            ItemsSource="{Binding AccountTypes}"
                            SelectionMode="Single"
                            SelectionChanged="OnTypeSelected">
                <CollectionView.EmptyView>
                    <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Padding="20">
                        <Label Text="No account types yet" FontSize="18" TextColor="Gray" HorizontalTextAlignment="Center" />
                        <Label Text="Tap + to add a type" FontSize="14" TextColor="LightGray" HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:AccountType">
                        <SwipeView>
                            <SwipeView.RightItems>
                                <SwipeItems>
                                    <SwipeItem Text="Delete"
                                               BackgroundColor="Red"
                                               Command="{Binding Source={RelativeSource AncestorType={x:Type vm:AccountTypeViewModel}}, Path=DeleteAccountTypeCommand}"
                                               CommandParameter="{Binding .}" />
                                </SwipeItems>
                            </SwipeView.RightItems>

                            <Frame Margin="16,4" Padding="12"
                                   BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                                   CornerRadius="10" HasShadow="True">
                                <VerticalStackLayout Spacing="2">
                                    <Label Text="{Binding Name}"
                                           FontSize="16"
                                           FontAttributes="Bold" />
                                    <Label Text="{Binding Description}"
                                           FontSize="13"
                                           TextColor="Gray"
                                           LineBreakMode="TailTruncation" />
                                </VerticalStackLayout>
                            </Frame>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Inline Form -->
            <Frame Grid.Row="1"
                   IsVisible="{Binding IsFormVisible}"
                   Margin="16,8" Padding="16"
                   BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2A2A2A}"
                   CornerRadius="12" HasShadow="True">
                <VerticalStackLayout Spacing="12">
                    <Label Text="{Binding FormTitle}"
                           FontSize="16"
                           FontAttributes="Bold" />

                    <Entry Text="{Binding TypeName}"
                           Placeholder="Type name (required)" />

                    <Entry Text="{Binding TypeDescription}"
                           Placeholder="Description (optional)" />

                    <HorizontalStackLayout Spacing="8" HorizontalOptions="End">
                        <Button Text="Cancel"
                                Command="{Binding CancelFormCommand}"
                                BackgroundColor="{AppThemeBinding Light=#E0E0E0, Dark=#444444}"
                                TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                CornerRadius="8"
                                HeightRequest="36"
                                FontSize="13" />
                        <Button Text="Save"
                                Command="{Binding SaveAccountTypeCommand}"
                                BackgroundColor="{AppThemeBinding Light=#6200EE, Dark=#BB86FC}"
                                TextColor="White"
                                CornerRadius="8"
                                HeightRequest="36"
                                FontSize="13" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>
        </Grid>

        <!-- FAB -->
        <Button Grid.Row="1"
                Text="+"
                FontSize="28"
                WidthRequest="60"
                HeightRequest="60"
                CornerRadius="30"
                BackgroundColor="{AppThemeBinding Light=#6200EE, Dark=#BB86FC}"
                TextColor="White"
                HorizontalOptions="End"
                VerticalOptions="End"
                Margin="0,0,20,20"
                Command="{Binding ShowAddFormCommand}"
                Shadow="{OnPlatform Default={Shadow Brush=Black, Offset='2,4', Radius=8, Opacity=0.3}}" />
    </Grid>

</ContentPage>
